generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model avatars {
  idAvatar     Int    @id @default(autoincrement())
  nombreAvatar String @db.VarChar(100)
  urlAvatar    String @unique @db.VarChar(255)

  usuarios usuarios[]
}

model usuarios {
  idUsuario              Int       @id @default(autoincrement())
  email                  String    @unique(map: "email") @db.VarChar(255)
  contraseña             String    @map("contraseña") @db.VarChar(255)
  nombreTutor            String?   @db.VarChar(100)
  nombreInfante          String    @db.VarChar(100)
  FechaNacimientoInfante DateTime? @db.Date
  idAvatar               Int?
  fechaRegistro          DateTime? @default(now()) @db.Timestamp(0)

  avatar avatars? @relation(fields: [idAvatar], references: [idAvatar])

  progresos progresolectura[]
  favoritos favoritos[]
  logrosUsuariologros usuariologros[]
  cuentos cuentos[]

  @@index([idAvatar], map: "idAvatar")

}

model cuentos {
  idCuento         Int       @id @default(autoincrement())
  tituloCuento     String    @db.VarChar(255)
  descripcion      String?   @db.Text
  urlPortada       String?   @db.VarChar(255)
  edadRecomentada  Int?
  fechaPublicacion DateTime? @default(now()) @db.Timestamp(0)
  idUsuario        Int?

  autor usuarios? @relation(fields: [idUsuario], references: [idUsuario])

  paginas    paginas[]
  categorias cuentocategoria[]
  progresos  progresolectura[]
  favoritos  favoritos[]

  @@index([idUsuario], map: "idx_cuentos_idUsuario")
}

model categoriascuentos {
  idCategoria     Int     @id @default(autoincrement())
  nombreCategoria String  @unique @db.VarChar(50)
  descripcion     String? @db.Text

  cuentos cuentocategoria[]
}

model cuentocategoria {
  idCategoria Int
  idCuento    Int

  categoria categoriascuentos @relation(fields: [idCategoria], references: [idCategoria])
  cuento    cuentos           @relation(fields: [idCuento], references: [idCuento])

  @@id([idCategoria, idCuento])
  @@index([idCuento], map: "idx_catcuento_idCuento")
}

model favoritos {
  idUsuario     Int
  idCuento      Int
  fechaAgregado DateTime? @default(now()) @db.Timestamp(0)

  usuario usuarios @relation(fields: [idUsuario], references: [idUsuario])
  cuento  cuentos  @relation(fields: [idCuento], references: [idCuento])

  @@id([idUsuario, idCuento])
  @@index([idCuento], map: "idx_favoritos_idCuento")
}

model logros {
  idLogro     Int     @id @default(autoincrement())
  nombreLogro String  @db.VarChar(100)
  descripcion String? @db.Text
  urlIcono    String? @db.VarChar(255)

  usuarios usuariologros[]
}

model paginas {
  idPagina     Int     @id @default(autoincrement())
  idCuento     Int
  numeroPagina Int
  texto        String? @db.Text
  urlImagen    String? @db.VarChar(255)
  urlAudio     String? @db.VarChar(255)

  cuento cuentos @relation(fields: [idCuento], references: [idCuento])

  @@unique([idCuento, numeroPagina], map: "unique_pagina_por_cuento")
}

model progresolectura {
  idProgreso         Int       @id @default(autoincrement())
  idUsuario          Int
  idCuento           Int
  ultimaPaginaLeida  Int?      @default(0)
  completado         Boolean   @default(false)
  fechaActualizacion DateTime? @default(now()) @db.Timestamp(0)

  usuario usuarios @relation(fields: [idUsuario], references: [idUsuario])
  cuento  cuentos  @relation(fields: [idCuento], references: [idCuento])

  @@unique([idUsuario, idCuento], map: "unique_progreso_usuario_cuento")
  @@index([idCuento], map: "idx_progreso_idCuento")
}

model usuariologros {
  idUsuarioLogo Int       @id @default(autoincrement())
  idUsuario     Int
  idLogro       Int
  fechaObtenido DateTime? @default(now()) @db.Timestamp(0)

  usuario usuarios @relation(fields: [idUsuario], references: [idUsuario])
  logro   logros   @relation(fields: [idLogro], references: [idLogro])

  @@unique([idUsuario, idLogro], map: "unique_logro_usuario")
  @@index([idLogro], map: "idx_usuariologros_idLogro")
}
